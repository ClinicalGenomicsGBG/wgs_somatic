Bootstrap: library
From: centos:7
Stage: build


%files
    petasuite-cloud-edition-1.2.6p10-1.x86_64.rpm /opt
    1000G_phase1.indels.b37.vcf.gz databases/
    1000G_phase1.indels.b37.vcf.gz.tbi databases/
    dbsnp_138.b37.vcf.gz databases/
    dbsnp_138.b37.vcf.gz.tbi databases/
    hs37d5.dict databases/
    hs37d5.fa databases/
    hs37d5.fa.amb databases/
    hs37d5.fa.ann databases/
    hs37d5.fa.bwt databases/
    hs37d5.fa.fai databases/
    hs37d5.fa.pac databases/
    hs37d5.fa.sa databases/
    Mills_and_1000G_gold_standard.indels.b37.vcf.gz databases/
    Mills_and_1000G_gold_standard.indels.b37.vcf.gz.tbi databases/
    SentieonDNAscopeModelBeta0.5.model databases/
    Sentieon_GiAB_201711.model databases/

%post
    # Install python3 and other requirements for git and pip3
    yum install -y python3
    yum install -y epel-release
    yum install -y python3-pip
    yum -y groupinstall "Development Tools"
    yum -y install wget

    # Get sentieon
    wget https://s3.amazonaws.com/sentieon-release/software/sentieon-genomics-201911.tar.gz #-P /tmp/test/

    # Unzip using tar
    tar -zxvf sentieon-genomics-201911.tar.gz

    # Install vim
    yum install -y vim

    # Install PetaSuite
    yum install -y /opt/petasuite-cloud-edition-1.2.6p10-1.x86_64.rpm

%environment
    # below will be set with bind during execute
    PETASUITE_REFPATH=/opt/petagene/corpus
    LD_PRELOAD=/usr/lib/petalink.so
    SENTIEON_LICENSE=medair1.medair.lcl:8990
    export PETASUITE_REFPATH LD_PRELOAD SENTIEON_LICENSE 

%runscript
    exec /bin/bash "$@"

%labels
    Author Vilma Canfjorden & Mathias J (gjorde coolaste grejerna)
    Version v0.0.2
